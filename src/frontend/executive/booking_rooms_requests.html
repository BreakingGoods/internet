<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EasyRoom Reservation System</title>
 
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Bootstrap Icons -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.5.8/dist/sweetalert2.all.min.js"></script>
    <script src="sweetalert2.min.js"></script>
    <link rel="stylesheet" href="sweetalert2.min.css">
 
    <!-- ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà executive.css ‡∏î‡πâ‡∏ß‡∏¢ <style> -->
    <style>
      body {
        margin: 0;
        font-family: Arial, sans-serif;
        background-color: #f5f5f5;
      }
      .container {
        display: flex;
        /* height: 100vh; ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î */
      }
 
      .notification-btn {
        position: relative;
        display: inline-block;
        color: white;
        padding: 10px 20px;
        border-radius: 5px;
        font-size: 16px;
        font-family: Arial, sans-serif;
      }
      .notification-badge {
        position: absolute;
        top: -5px;
        right: -5px;
        background-color: red;
        color: white;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        font-weight: bold;
        border: 2px solid white;
      }
 
      .main-content {
        margin-left: 20%;
        margin-top: 3%;
        margin-bottom: 5%;
        flex: 1;
        padding: 20px;
        padding-top: 2px;
        background-color: #e8e8e8;
        border-radius: 10px;
      }
 
      .tab-bar {
        display: flex;
        padding: 10px;
        justify-content: flex-start;
        align-items: center;
        gap: 10px;
      }
      .tab {
        padding: 15px 20px;
        cursor: pointer;
        font-weight: bold;
        color: #555;
        text-align: center;
      }
      .tab.active {
        color: #000;
        border-bottom: 2px solid #000;
      }
      .tab-bar button.active {
        background-color: #f5f5f5;
        border: 1px solid #ccc;
        font-weight: bold;
      }
 
      table {
        width: 100%;
        border-collapse: collapse;
      }
      th {
        text-align: center;
        padding: 10px;
        border-bottom: 1px solid #ddd;
      }
      td {
        text-align: center;
      }
 
      .actions {
        display: flex;
        gap: 10px;
      }
      .actions button {
        padding: 5px 10px;
        border: none;
        cursor: pointer;
        border-radius: 5px;
      }
      .actions2 {
        text-align: center;
        gap: 10px;
      }
      .actions2 button {
        padding: 5px 10px;
        border: none;
        cursor: pointer;
        border-radius: 5px;
      }
 
      .approve {
        background-color: #4caf50;
        color: white;
      }
      .reject {
        background-color: #ff0606;
        color: white;
      }
      .icon-button {
        display: flex;
        align-items: center;
        gap: 5px;
      }
      .receive {
        justify-content: center;
      }
      .tab a {
        text-decoration: none;
        color: inherit;
      }
 
      .dropdown-container {
        display: inline-block;
        position: relative;
        font-family: Arial, sans-serif;
        margin-left: auto;
      }
      select {
        width: 135px;
        padding: 10px;
        font-size: 14px;
        color: #7e7e7e;
        border: 1px solid #e7e7e7;
        border-radius: 8px;
        background-color: #f9fbff;
        outline: none;
        cursor: pointer;
      }
      select:focus {
        border-color: #aaa;
      }
     
     
 
      /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ Sidebar Responsive */
      @media (max-width: 992px) {
        .main-content {
          margin-left: 0;
          margin-top: 120px; /* ‡πÄ‡∏ß‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ sidebar ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô */
        }
      }

      .swal2-container {
        position: absolute !important;
      }

    </style>
  </head>
 
  <body>
    <div class="container-fluid">
      <!-- Sidebar ‡∏à‡∏∞ fetch() ‡∏à‡∏≤‡∏Å sidebar.html -->
      <div id="sidebar-container"></div>
 
      <!-- Main Content -->
      <div class="main-content">
        <!-- ‡πÅ‡∏ñ‡∏ö‡πÄ‡∏°‡∏ô‡∏π Tab -->
        <div class="tab-bar">
          <div class="tab active"><a href="#">‡∏Ñ‡∏≥‡∏Ç‡∏≠</a></div>
          <div class="tab">
            <a href="accept_requests_booking_rooms.html">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</a>
          </div>
          <div class="tab">
            <a href="not_accept_requests_booking_rooms.html">‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</a>
          </div>
          <div class="dropdown-container">
            <select id="sorttime">
              <option value="oldest">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</option>
              <option value="newest">‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</option>
            </select>
          </div>
        </div>

        <!-- Modal -->
        <div class="modal fade" id="detailsModal" tabindex="-1" aria-labelledby="detailsModalLabel" aria-hidden="true">
          <div class="modal-dialog">
              <div class="modal-content">
                  <div class="modal-header">
                      <h5 class="modal-title" id="detailsModalLabel"><strong>üì¢‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‚ùó</strong></h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body">
                      <p><strong>‡∏Ç‡∏≠‡πÉ‡∏ä‡πâ‡∏´‡πâ‡∏≠‡∏á:</strong> <span id="roomName"></span></p>
                      <p><strong>‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏´‡πâ‡∏≠‡∏á:</strong> <span id="bookingTime"></span></p>
                      <hr>
                      <h6><strong>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏áüìå</strong></h6>
                      <p><strong>‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏¥‡∏™‡∏¥‡∏ï / ‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå:</strong> <span id="userID"></span></p> 
                      <p><strong>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•:</strong> <span id="userName"></span></p> 
                      <p><strong>Email:</strong> <span id="userEmail"></span></p> 
                      <p><strong>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠:</strong> <span id="userPhone"></span></p> 
                      <p><strong>‡∏™‡∏≤‡∏Ç‡∏≤‡∏ß‡∏¥‡∏ä‡∏≤:</strong> <span id="userDepartment"></span></p> 
                      <hr>
                      <h6><strong>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á‡∏£‡πà‡∏ß‡∏°üìå</strong></h6>
                      <ul id="participantList"></ul>
                      <hr>
                      <p><strong>‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå:</strong> <span id="bookingReason"></span></p>
                      <p><strong>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á:</strong> <span id="detailbookingReason"></span></p>
                  </div>
              </div>
          </div>
        </div>

 
        <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô‡∏î‡πâ‡∏ß‡∏¢ .table-responsive -->
        <div class="table-responsive">
          <table class="table">
            <thead>
              <tr>
                <th style="color: #929292">
                  ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
                  <i
                    class="bi bi-caret-down-fill"
                    style="
                      margin-left: 5px;
                      cursor: pointer;
                      color: #929292;
                      font-size: 10px;
                    "
                    onclick="toggleCalendar()"
                  ></i>
                </th>
                <!-- ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô Dropdown -->
                <div
                  id="dropdown-calendar"
                  style="
                    display: none;
                    position: absolute;
                    background: white;
                    box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
                    border-radius: 5px;
                    padding: 10px;
                  "
                >
                  <div
                    style="
                      display: flex;
                      justify-content: space-between;
                      margin-bottom: 10px;
                    "
                  >
                    <select
                      id="month-select"
                      onchange="renderCustomCalendar()"
                    ></select>
                    <select
                      id="year-select"
                      onchange="renderCustomCalendar()"
                    ></select>
                  </div>
                  <div id="custom-calendar"></div>
                </div>
                <!-- /‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô -->
 
                <script>
                  const currentDate = new Date();
 
                  function toggleCalendar() {
                    const calendar =
                      document.getElementById("dropdown-calendar");
                    if (
                      calendar.style.display === "none" ||
                      calendar.style.display === ""
                    ) {
                      calendar.style.display = "block";
                      initializeCalendar();
                    } else {
                      calendar.style.display = "none";
                    }
                  }
 
                  document.addEventListener("click", function (event) {
                    const calendar =
                      document.getElementById("dropdown-calendar");
                    const iconElement = document.querySelector(
                      "i.bi-caret-down-fill"
                    );
                    if (
                      !calendar.contains(event.target) &&
                      event.target !== iconElement
                    ) {
                      calendar.style.display = "none";
                    }
                  });
 
                  function initializeCalendar() {
                    const monthSelect = document.getElementById("month-select");
                    const yearSelect = document.getElementById("year-select");
 
                    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
                    monthSelect.innerHTML = "";
                    const monthNames = [
                      "January",
                      "February",
                      "March",
                      "April",
                      "May",
                      "June",
                      "July",
                      "August",
                      "September",
                      "October",
                      "November",
                      "December",
                    ];
                    monthNames.forEach((month, index) => {
                      const option = document.createElement("option");
                      option.value = index;
                      option.text = month;
                      if (index === currentDate.getMonth())
                        option.selected = true;
                      monthSelect.appendChild(option);
                    });
 
                    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏õ‡∏µ
                    yearSelect.innerHTML = "";
                    const startYear = currentDate.getFullYear() - 10;
                    const endYear = currentDate.getFullYear() + 50;
                    for (let year = startYear; year <= endYear; year++) {
                      const option = document.createElement("option");
                      option.value = year;
                      option.text = year;
                      if (year === currentDate.getFullYear())
                        option.selected = true;
                      yearSelect.appendChild(option);
                    }
 
                    renderCustomCalendar();
                  }
 
                  function renderCustomCalendar() {
                    const calendarDiv =
                      document.getElementById("custom-calendar");
                    calendarDiv.innerHTML = "";
 
                    const selectedMonth = parseInt(
                      document.getElementById("month-select").value
                    );
                    const selectedYear = parseInt(
                      document.getElementById("year-select").value
                    );
 
                    const daysInMonth = new Date(
                      selectedYear,
                      selectedMonth + 1,
                      0
                    ).getDate();
                    const firstDay = new Date(
                      selectedYear,
                      selectedMonth,
                      1
                    ).getDay();
 
                    const calendarTable = document.createElement("table");
                    calendarTable.style.borderCollapse = "collapse";
                    calendarTable.style.width = "100%";
 
                    const headerRow = document.createElement("tr");
                    ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"].forEach(
                      (day) => {
                        const th = document.createElement("th");
                        th.style.textAlign = "center";
                        th.innerText = day;
                        headerRow.appendChild(th);
                      }
                    );
                    calendarTable.appendChild(headerRow);
 
                    let date = 1;
                    for (let i = 0; i < 6; i++) {
                      const row = document.createElement("tr");
                      for (let j = 0; j < 7; j++) {
                        const cell = document.createElement("td");
                        cell.style.textAlign = "center";
                        cell.style.padding = "5px";
                        cell.style.border = "1px solid #ddd";
                        if (i === 0 && j < firstDay) {
                          cell.innerText = "";
                        } else if (date > daysInMonth) {
                          break;
                        } else {
                          cell.innerText = date;
                          cell.style.cursor = "pointer";
                          cell.onclick = function () {
                            document.getElementById(
                              "dropdown-calendar"
                            ).style.display = "none";
                          };
                          date++;
                        }
                        row.appendChild(cell);
                      }
                      calendarTable.appendChild(row);
                    }
                    calendarDiv.appendChild(calendarTable);
                  }
                </script>
 
                <th style="color: #929292">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
                <th style="color: #929292">
                  ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á
                  <div class="dropdown d-inline">
                    <i
                      class="bi bi-caret-down-fill"
                      type="button"
                      data-bs-toggle="dropdown"
                      aria-expanded="false"
                      style="color: #929292; font-size: 10px"
                    ></i>
                    <ul class="dropdown-menu">
                      <li><a class="dropdown-item" href="#" onclick="filterTableRole('‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î')">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</a></li>
                      <li><a class="dropdown-item" href="#" onclick="filterTableRole('‡∏ô‡∏¥‡∏™‡∏¥‡∏ï')">‡∏ô‡∏¥‡∏™‡∏¥‡∏ï</a></li>
                      <li><a class="dropdown-item" href="#" onclick="filterTableRole('‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå')">‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå</a></li>
                    </ul>
                  </div>
                </th>
                <th style="color: #929292">
                  ‡∏´‡πâ‡∏≠‡∏á
                  <div class="dropdown d-inline">
                    <i
                      class="bi bi-caret-down-fill"
                      type="button"
                      data-bs-toggle="dropdown"
                      aria-expanded="false"
                      style="color: #929292; font-size: 10px"
                    ></i>
                    <ul class="dropdown-menu">
                      <li><a class="dropdown-item" href="#" onclick="filterTableRoom('‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î')">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</a></li>
                      <li><a class="dropdown-item" href="#" onclick="filterTableRoom('307')">307</a></li>
                      <li><a class="dropdown-item" href="#" onclick="filterTableRoom('414')">414</a></li>
                    </ul>
                  </div>  
                </th>
                <th style="color: #929292">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏¥‡∏™‡∏¥‡∏ï(‡∏Ñ‡∏ô)</th>
                <th style="color: #929292">‡πÄ‡∏ß‡∏•‡∏≤‡∏à‡∏≠‡∏á</th>
                <th style="color: #929292">‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</th>
              </tr>
            </thead>
 
            <tbody id="reservation-table">
              <!-- ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ -->
              <script>
 
                const today = new Date();
                const thaiDate = today.toLocaleString("th-TH", { timeZone: "Asia/Bangkok" });
                console.log(thaiDate);
             
                async function fetchData() {
                try {
                    // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å 2 API ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô
                    const [roomsResponse, studentsResponse ,TeacherResponse,participantResponse] = await Promise.all([
                        fetch('http://localhost:3000/room_request'),
                        fetch('http://localhost:3000/student'),
                        fetch('http://localhost:3000/teacher'),
                        fetch('http://localhost:3000/room_request_participant')
                       
                    ])
 
                    const roomsData = await roomsResponse.json();
                    const studentsData = await studentsResponse.json();
                    const TeacherData = await TeacherResponse.json();
                    const participantData = await participantResponse.json();
                    //console.log(TeacherData);
                    // JOIN ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ Student_ID
 
                    roomsData.forEach((attribute) => {
                      const thaiDateTime = new Date(attribute.submitted_time).toLocaleString("th-TH", {
                          timeZone: "Asia/Bangkok"
                      });
                      console.log(thaiDateTime);
                    });
                 
                    const filteredData = roomsData.filter((row) => {
                      const usedDateTime = new Date(row.used_date); // ‡πÅ‡∏õ‡∏•‡∏á used_date ‡πÄ‡∏õ‡πá‡∏ô Date
                      const thaiUsedDateTime = new Date(
                        usedDateTime.toLocaleString("en-US", {
                          timeZone: "Asia/Bangkok",
                        })
                      );

                      // ‡πÅ‡∏¢‡∏Å‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á ‡∏ô‡∏≤‡∏ó‡∏µ ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡∏à‡∏≤‡∏Å start_time (‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö "HH:MM:SS")
                      const [hours, minutes, seconds] = row.start_time
                        .split(":")
                        .map(Number);
                      thaiUsedDateTime.setHours(hours, minutes, seconds, 0); // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö start_time

                      console.log(
                        "Room Request ID:",
                        row.room_request_id,
                        "Start Time (Thai Time):",
                        thaiUsedDateTime.toLocaleString("th-TH", {
                          timeZone: "Asia/Bangkok",
                        }),
                        "Used Date (Thai Time):",
                        thaiUsedDateTime.toLocaleDateString("th-TH", {
                          timeZone: "Asia/Bangkok",
                        })
                      );

                      const thaiSubmittedTime = new Date(row.submitted_time); // ‡πÅ‡∏õ‡∏•‡∏á submitted_time ‡πÄ‡∏õ‡πá‡∏ô Date Object
                      const today = new Date();
                      today.setHours(0, 0, 0, 0); // ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô 00:00:00 ‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ

                      const thaiToday = new Date(
                        today.toLocaleString("en-US", {
                          timeZone: "Asia/Bangkok",
                        })
                      ); // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏ã‡∏ô‡πÑ‡∏ó‡∏¢

                      return (
                        row.request_status === "‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥" &&
                        row.request_type === "‡∏ô‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤" &&
                        thaiUsedDateTime >= new Date() // ‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
                      );
                    });
                 
                    roomsData.forEach((x) => console.log(new Date(x.submitted_time).toLocaleDateString('th')>= '26/02/2568'));
                   
                      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ñ‡πâ‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏á‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß
                    for (const row of filteredData) {
                        const requestDate = new Date(row.used_date);
                        requestDate.setHours(0, 0, 0, 0);
 
                        if (requestDate < today) {
                            await updateStatus(row.room_request_id, '‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥');
                        }
                    }
                   
                    // ‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á object ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏µ room_request_id ‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ô
                        const participantCountMap = participantData.reduce((acc, participant) => {
                          acc[participant.room_request_id] = (acc[participant.room_request_id] || 0) + 1;
                          return acc;
                      }, {});
         
                      console.log("üìå ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏ï‡πà‡∏≠ room_request_id:", participantCountMap);
                   
                        const mergedData = filteredData.map(room => {
                        const student = studentsData.find(s => s.student_id === room.student_id) || {};
                        const Teacher = TeacherData.find(T => T.teacher_id === room.teacher_id) || {};
                       
                        return {
                            ...room,
                            full_name: student.full_name || Teacher.full_name,
                            role: student.role || Teacher.role,
                            participantCount: participantCountMap[room.room_request_id] || 0 // ‚úÖ ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°
 
                        };
                    });
 
                   
                   
 
                    console.log("‚úÖ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß:", mergedData);
           
                    const tableBody = document.getElementById('reservation-table');
                    tableBody.innerHTML = '';
           
                    mergedData.forEach(row => {
                        tableBody.innerHTML += `
                            <tr>
                                <td class="text-center">${new Date(row.submitted_time).toLocaleDateString('th') }</td>
                                <td class="text-center">${row.full_name}</td>
                                <td class="text-center">${row.role}</td>
                                <td class="text-center">${row.room_id}</td>
                                <td class="text-center">${row.participantCount}</td>
                                <td class="text-center">
                                    ${getDayOfWeek(row.used_date) + ' ' + new Date(row.used_date).toLocaleDateString('th')}<br>
                                    ${row.start_time.slice(0, 5) + ' - ' + row.end_time.slice(0, 5)}<br>
                                    ${'(' + row.request_type + ')'}
                                </td>
                                <td class="text-center">
                                    <div>
                                        <button class="btn btn-success btn-sm" onclick="confirmstatus(${row.room_request_id}, '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥')"">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
                                        <button class="btn btn-danger btn-sm" onclick="updateStatus(${row.room_request_id}, '‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥')">‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
                                    </div>
                                    <div class="mt-2">
                                        <button class="btn btn-primary btn-sm" onclick="showDetails(${row.room_request_id})">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</button>
                                    </div>
                                </td>
 
                            </tr>
                        `;
                    });
           
                } catch (error) {
                    console.error('‚ùå Error fetching data:', error);
                }
            }
           
            async function updateStatus(requestId, newStatus) {
              try {
                  const response = await fetch('http://localhost:3000/updateStatus', {
                      method: "POST",
                      headers: {
                          "Content-Type": "application/json",
                      },
                      body: JSON.stringify({ requestId, status: newStatus }),
                  });
         
                  if (response.ok) {
                      fetchData(); // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡∏´‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
                  } else {
                      console.error("‚ùå Error updating status:", await response.json());
                      alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞");
                  }
              } catch (error) {
                  console.error("‚ùå Error updating status:", error);
                  alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ");
              }
            }
         
 
            document.addEventListener("DOMContentLoaded", fetchData);
                document.getElementById('detailModal').addEventListener('show.bs.modal', function (event) {
                    const button = event.relatedTarget;
                    document.getElementById('modal-date').textContent = button.getAttribute('data-date');
                    document.getElementById('modal-name').textContent = button.getAttribute('data-name');
                    document.getElementById('modal-room').textContent = button.getAttribute('data-room');
                    document.getElementById('modal-time').textContent = button.getAttribute('data-time');
                    document.getElementById('modal-reason').textContent = button.getAttribute('data-reason');
                });
 
                function getDayOfWeek(dateString) {
                  const days = ["‡∏≠‡∏≤.", "‡∏à.", "‡∏≠.", "‡∏û.", "‡∏û‡∏§.", "‡∏®.", "‡∏™."];
                  const date = new Date(dateString);
                  return days[date.getDay()];  // Returns 0-6 (0 = Sunday, 1 = Monday, ...)
              }
           
               
              </script>
 
              <!-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ -->
            </tbody>
          </table>
        </div>
        <!-- /table-responsive -->
      </div>
    </div>

    <!-- pop up  -->
    <script>
            async function confirmstatus(requestId, newStatus) {
              Swal.fire({
              title: "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á?",
              icon: "warning",
              showConfirmButton: true,
              showCancelButton: true,
              confirmButtonText: "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô",
              cancelButtonText: "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å",
              toast: false, // ‡πÉ‡∏ä‡πâ Toast mode
              position: "center", // ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Ç‡πâ‡∏≤‡∏á‡∏õ‡∏∏‡πà‡∏° (‡∏ã‡πâ‡∏≤‡∏¢‡∏ö‡∏ô)
              customClass: {
                  popup: "my-popup"
              }
              }).then(async (result) => {
                  if (result.isConfirmed) {
                      try {
                          // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô updateStatus() ‡πÅ‡∏•‡∏∞‡∏£‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏™‡∏£‡πá‡∏à
                          await updateStatus(requestId, newStatus);
                          
                          // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                          Swal.fire("‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ñ‡∏π‡∏Å‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï!", "‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß.", "success");
                      } catch (error) {
                          Swal.fire("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏î‡πâ", "error");
                          console.error(error);
                      }
                  }
              });
            }

            async function showDetails(requestID) {
                try {
                    const response = await fetch("http://localhost:3000/detailsPop");
                    const data = await response.json();

                    // ‡∏´‡∏≤ requestID ‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°
                    const booking = data.find(item => item.requestID === requestID);

                    if (!booking) {
                        alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á");
                        return;
                    }

                    // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á
                    document.getElementById("roomName").textContent = booking.roombooking;
                    document.getElementById("bookingTime").textContent = booking.timebooking;
                    document.getElementById("userID").textContent = booking.id;
                    document.getElementById("userName").textContent = booking.name;
                    document.getElementById("userEmail").textContent = booking.email;
                    document.getElementById("userPhone").textContent = booking.phone_number;
                    document.getElementById("userDepartment").textContent = booking.department;
                    document.getElementById("bookingReason").textContent = booking.bookingreason;
                    document.getElementById("detailbookingReason").textContent = booking.detailbookingreason;

                    // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á‡∏£‡πà‡∏ß‡∏°
                    const participantList = document.getElementById("participantList");
                    participantList.innerHTML = "";

                    const participants = data.filter(item => item.requestID === requestID && item.role !== "‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á");

                    if (participants.length > 0) {
                      participants.forEach((participant, index) => {
                          const li = document.createElement("li");
                          li.innerHTML = `
                              <strong>‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà ${index + 1}</strong><br>
                              <strong>‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏¥‡∏™‡∏¥‡∏ï:</strong> ${participant.id} <br>
                              <strong>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•:</strong> ${participant.name} <br>
                              <strong>Email:</strong> ${participant.email} <br>
                              <strong>‡∏™‡∏≤‡∏Ç‡∏≤‡∏ß‡∏¥‡∏ä‡∏≤:</strong> ${participant.department} <br><br>
                          `;
                          participantList.appendChild(li);
                      });
                    } else {
                        participantList.innerHTML = "<li>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á‡∏£‡πà‡∏ß‡∏°</li>";
                    }

                    // ‡πÅ‡∏™‡∏î‡∏á Modal
                    const modal = new bootstrap.Modal(document.getElementById("detailsModal"));
                    modal.show();
                } catch (error) {
                    console.error("‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î:", error);
                }
            }



    </script>

    <!-- !--fillter ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á -->
    <script>
      function filterTableRole(role) {
        const rows = document.querySelectorAll("#reservation-table tr");
      
        rows.forEach(row => {
          const roleCell = row.querySelector("td:nth-child(3)"); // ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á
      
          if (!roleCell) return;
      
          const roleText = roleCell.textContent.trim();
      
          if (role === "‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î" || roleText === role) {
            row.style.display = "";
          } else {
            row.style.display = "none";
          }
        });
      }

      function filterTableRoom(room_id) {
        const rows = document.querySelectorAll("#reservation-table tr");

        rows.forEach(row => {
          const room_idCell = row.querySelector("td:nth-child(4)");

          if (!room_idCell) return;

          const room_idText = room_idCell.textContent.trim();

          if (room_id === "‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î" || room_idText === room_id) {
            row.style.display = "";
          } else {
            row.style.display = "none";
          }
        });
      }

    </script>
 
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
 
    <!-- ‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå fetch Sidebar -->
    <script>
      fetch("sidebar.html")
        .then((resp) => resp.text())
        .then((html) => {
          document.getElementById("sidebar-container").innerHTML = html;
        })
        .then(() => {
          // Highlight ‡∏õ‡∏∏‡πà‡∏° "‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á"
          const btnStats = document.getElementById("btnReceive");
          btnStats.classList.add("btn-sidebar-active");
        })
        .catch((err) => console.error("Failed to load sidebar:", err));
    </script>
  </body>
</html>